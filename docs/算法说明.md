# MyQuant ç®—æ³•è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [ç®—æ³•æ¦‚è¿°](#ç®—æ³•æ¦‚è¿°)
- [ç³»ç»Ÿæ¶æ„ä¸ä»£ç æ¡†æ¶](#ç³»ç»Ÿæ¶æ„ä¸ä»£ç æ¡†æ¶)
- [æ ¸å¿ƒç»„ä»¶è°ƒç”¨å…³ç³»](#æ ¸å¿ƒç»„ä»¶è°ƒç”¨å…³ç³»)
- [ä»£ç æ‰§è¡Œæµç¨‹](#ä»£ç æ‰§è¡Œæµç¨‹)
- [æŠ€æœ¯æŒ‡æ ‡ç®—æ³•](#æŠ€æœ¯æŒ‡æ ‡ç®—æ³•)
- [ç­–ç•¥ç®—æ³•è¯¦è§£](#ç­–ç•¥ç®—æ³•è¯¦è§£)
- [é£é™©æ§åˆ¶ç®—æ³•](#é£é™©æ§åˆ¶ç®—æ³•)
- [æ€§èƒ½è¯„ä¼°ç®—æ³•](#æ€§èƒ½è¯„ä¼°ç®—æ³•)
- [æ•°æ®å¤„ç†ç®—æ³•](#æ•°æ®å¤„ç†ç®—æ³•)
- [ç®—æ³•ä¼˜åŒ–ä¸ä¿®å¤è®°å½•](#ç®—æ³•ä¼˜åŒ–ä¸ä¿®å¤è®°å½•)

## ğŸ¯ ç®—æ³•æ¦‚è¿°

MyQuantç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºEMAï¼ˆæŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿ï¼‰äº¤å‰ç­–ç•¥çš„é‡åŒ–äº¤æ˜“å›æµ‹å¹³å°ï¼Œé›†æˆäº†å¤šç§é£é™©æ§åˆ¶å’Œä»“ä½ç®¡ç†ç®—æ³•ï¼Œå®ç°äº†ä»æ•°æ®è·å–åˆ°ç­–ç•¥æ‰§è¡Œçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚

### æ ¸å¿ƒç®—æ³•æ¶æ„
```
æ•°æ®è·å– â†’ æŠ€æœ¯æŒ‡æ ‡è®¡ç®— â†’ ä¿¡å·ç”Ÿæˆ â†’ ä»“ä½ç®¡ç† â†’ é£é™©æ§åˆ¶ â†’ æ€§èƒ½è¯„ä¼° â†’ ç»“æœè¾“å‡º
```

### æ”¯æŒçš„ç­–ç•¥ç±»å‹
1. **SimpleEMA**: åŸºç¡€EMAäº¤å‰ç­–ç•¥
2. **StagedEMA**: åˆ†æ‰¹å…¥åœºEMAç­–ç•¥
3. **ComplexEMA**: å¤æ‚å¤šé‡é€€å‡ºæ¡ä»¶EMAç­–ç•¥
4. **AdvancedStagedEMA**: é«˜çº§åˆ†æ‰¹ç­–ç•¥ï¼ˆæ”¯æŒå¤šæ—¶é—´æ¡†æ¶ï¼‰

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ä¸ä»£ç æ¡†æ¶

### 1. æ•´ä½“æ¶æ„è®¾è®¡

MyQuantç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å±‚æ¬¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  StrategyManager (ç­–ç•¥ç®¡ç†å™¨)  â”‚  run_strategy.py (è¿è¡Œå™¨)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç­–ç•¥å±‚ (Strategy Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SimpleEMA â”‚ StagedEMA â”‚ ComplexEMA â”‚ AdvancedStagedEMA      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€å±‚ (Base Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BaseStrategy (ç­–ç•¥åŸºç±»)  â”‚  ConfigManager (é…ç½®ç®¡ç†å™¨)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å±‚ (Data Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              DataManager (æ•°æ®ç®¡ç†å™¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 2.1 åº”ç”¨å±‚ç»„ä»¶

**StrategyManager (ç­–ç•¥ç®¡ç†å™¨)**
- **æ–‡ä»¶ä½ç½®**: `strategy_manager.py`
- **ä¸»è¦èŒè´£**: 
  - ç®¡ç†å¤šä¸ªç­–ç•¥çš„å¹¶è¡Œè¿è¡Œ
  - ç”Ÿæˆç­–ç•¥å¯¹æ¯”æŠ¥å‘Š
  - ç»Ÿä¸€é…ç½®ç®¡ç†
  - ç»“æœæ±‡æ€»å’Œå¯è§†åŒ–

**run_strategy.py (ç­–ç•¥è¿è¡Œå™¨)**
- **æ–‡ä»¶ä½ç½®**: `run_strategy.py`
- **ä¸»è¦èŒè´£**:
  - å•ä¸ªç­–ç•¥çš„å¿«é€Ÿè¿è¡Œ
  - å‘½ä»¤è¡Œå‚æ•°å¤„ç†
  - ç­–ç•¥å®ä¾‹åŒ–å’Œé…ç½®
  - ç»“æœè¾“å‡ºå’Œå›¾è¡¨ç”Ÿæˆ

#### 2.2 ç­–ç•¥å±‚ç»„ä»¶

**BaseStrategy (ç­–ç•¥åŸºç±»)**
- **æ–‡ä»¶ä½ç½®**: `strategies/base_strategy.py`
- **ä¸»è¦èŒè´£**:
  - å®šä¹‰ç­–ç•¥é€šç”¨æ¥å£
  - æä¾›æ•°æ®å¤„ç†æ–¹æ³•
  - å®ç°äº¤æ˜“ç®¡ç†åŠŸèƒ½
  - ç»Ÿä¸€ç»“æœè¾“å‡ºæ ¼å¼

**å…·ä½“ç­–ç•¥ç±»**
- **SimpleEMAStrategy**: `strategies/simple_ema_strategy.py`
- **StagedEMAStrategy**: `strategies/staged_ema_strategy.py`
- **ComplexEMAStrategy**: `strategies/complex_ema_strategy.py`
- **AdvancedStagedEMAStrategy**: `strategies/advanced_staged_ema_strategy.py`

#### 2.3 åŸºç¡€å±‚ç»„ä»¶

**ConfigManager (é…ç½®ç®¡ç†å™¨)**
- **æ–‡ä»¶ä½ç½®**: `config/config_manager.py`
- **ä¸»è¦èŒè´£**:
  - é…ç½®æ–‡ä»¶çš„è¯»å–å’Œä¿å­˜
  - ç­–ç•¥å‚æ•°éªŒè¯
  - é»˜è®¤é…ç½®ç®¡ç†

**DataManager (æ•°æ®ç®¡ç†å™¨)**
- **æ–‡ä»¶ä½ç½®**: `data_manager.py`
- **ä¸»è¦èŒè´£**:
  - Kçº¿æ•°æ®è·å–å’Œç¼“å­˜
  - æ•°æ®æ ¼å¼è½¬æ¢
  - ç¼“å­˜ç®¡ç†å’Œä¼˜åŒ–

### 3. ç›®å½•ç»“æ„è¯´æ˜

```
myquant1008/
â”œâ”€â”€ run_strategy.py             # å•ç­–ç•¥è¿è¡Œå…¥å£
â”œâ”€â”€ strategy_manager.py         # å¤šç­–ç•¥ç®¡ç†å™¨
â”œâ”€â”€ data_manager.py            # æ•°æ®ç®¡ç†å™¨
â”œâ”€â”€ chart_generator.py         # å›¾è¡¨ç”Ÿæˆå™¨
â”œâ”€â”€ config.json               # ç»Ÿä¸€é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt          # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ strategies/              # ç­–ç•¥æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ base_strategy.py     # ç­–ç•¥åŸºç±»
â”‚   â”œâ”€â”€ simple_ema_strategy.py
â”‚   â”œâ”€â”€ staged_ema_strategy.py
â”‚   â”œâ”€â”€ complex_ema_strategy.py
â”‚   â””â”€â”€ advanced_staged_ema_strategy.py
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config_manager.py    # é…ç½®ç®¡ç†å™¨
â”‚   â””â”€â”€ strategies_config.json
â”œâ”€â”€ output/                  # è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ *.png               # å›¾è¡¨æ–‡ä»¶
â”‚   â”œâ”€â”€ *.csv               # æŠ¥å‘Šæ–‡ä»¶
â”‚   â””â”€â”€ *.json              # è¯¦ç»†ç»“æœ
â”œâ”€â”€ docs/                   # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ç®—æ³•è¯´æ˜.md
â”‚   â”œâ”€â”€ APIæ¥å£æ–‡æ¡£.md
â”‚   â”œâ”€â”€ æ“ä½œè¯´æ˜.md
â”‚   â””â”€â”€ ç­–ç•¥è¿è¡Œç»“æœæ€»ç»“.md
â””â”€â”€ temp/                   # ä¸´æ—¶ç¼“å­˜ç›®å½•
    â””â”€â”€ data_cache/         # æ•°æ®ç¼“å­˜
```

## ğŸ”„ æ ¸å¿ƒç»„ä»¶è°ƒç”¨å…³ç³»

### 1. å•ç­–ç•¥è¿è¡Œæµç¨‹

```mermaid
graph TD
    A[run_strategy.py] --> B[è§£æå‘½ä»¤è¡Œå‚æ•°]
    B --> C[åŠ è½½ç­–ç•¥é…ç½®]
    C --> D[åˆ›å»ºç­–ç•¥å®ä¾‹]
    D --> E[é…ç½®ç­–ç•¥å‚æ•°]
    E --> F[æ‰§è¡Œç­–ç•¥å›æµ‹]
    F --> G[ç”Ÿæˆå›¾è¡¨å’ŒæŠ¥å‘Š]
    G --> H[è¾“å‡ºç»“æœ]
```

### 2. å¤šç­–ç•¥ç®¡ç†æµç¨‹

```mermaid
graph TD
    A[StrategyManager] --> B[åŠ è½½config.json]
    B --> C[åˆ›å»ºè¾“å‡ºç›®å½•]
    C --> D[éå†ç­–ç•¥åˆ—è¡¨]
    D --> E[åŠ¨æ€å¯¼å…¥ç­–ç•¥ç±»]
    E --> F[ç­–ç•¥å®ä¾‹åŒ–]
    F --> G[é…ç½®ç­–ç•¥å‚æ•°]
    G --> H[æ‰§è¡Œç­–ç•¥å›æµ‹]
    H --> I[æ”¶é›†è¿è¡Œç»“æœ]
    I --> J[ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š]
    J --> K[ç”Ÿæˆå¯¹æ¯”å›¾è¡¨]
```

### 3. ç­–ç•¥è¿è¡Œè°ƒç”¨é“¾

```mermaid
graph LR
    A[ç­–ç•¥å®ä¾‹] --> B[BaseStrategy.run_backtest]
    B --> C[DataManager.get_kline_data]
    C --> D[calculate_indicators]
    D --> E[_execute_backtest_loop]
    E --> F[plot_trading_chart]
    F --> G[get_strategy_results]
```

### 4. æ•°æ®æµå‘å›¾

```mermaid
graph TD
    A[Binance API] --> B[DataManager]
    B --> C[ç¼“å­˜æ£€æŸ¥]
    C --> D{ç¼“å­˜æœ‰æ•ˆ?}
    D -->|æ˜¯| E[ä»ç¼“å­˜åŠ è½½]
    D -->|å¦| F[ä»APIè·å–]
    F --> G[ä¿å­˜åˆ°ç¼“å­˜]
    E --> H[æ•°æ®é¢„å¤„ç†]
    G --> H
    H --> I[ç­–ç•¥è®¡ç®—]
    I --> J[äº¤æ˜“ä¿¡å·ç”Ÿæˆ]
    J --> K[ä»“ä½ç®¡ç†]
    K --> L[é£é™©æ§åˆ¶]
    L --> M[ç»“æœç»Ÿè®¡]
```

## âš™ï¸ ä»£ç æ‰§è¡Œæµç¨‹

### 1. å•ç­–ç•¥æ‰§è¡Œæµç¨‹

```python
# run_strategy.py ä¸»ç¨‹åºå…¥å£
if __name__ == "__main__":
    # 1. è§£æå‘½ä»¤è¡Œå‚æ•°
    strategy_name = sys.argv[1] if len(sys.argv) > 1 else 'simple_ema'
    
    # 2. åˆ›å»ºç­–ç•¥å®ä¾‹
    strategy = create_strategy(strategy_name)
    
    # 3. é…ç½®ç­–ç•¥å‚æ•°
    configure_strategy(strategy)
    
    # 4. æ‰§è¡Œå›æµ‹
    result = strategy.run_backtest()
    
    # 5. è¾“å‡ºç»“æœ
    print_results(result)
```

### 2. ç­–ç•¥åŸºç±»æ‰§è¡Œæµç¨‹

```python
# BaseStrategy.run_backtest() æ–¹æ³•æ‰§è¡Œæµç¨‹
def run_backtest(self):
    # 1. é‡ç½®äº¤æ˜“çŠ¶æ€
    self.reset_trading_state()
    
    # 2. è·å–Kçº¿æ•°æ®
    data = self.data_manager.get_kline_data(
        symbol=self.symbol,
        start_date=self.start_date,
        end_date=self.end_date
    )
    
    # 3. æ•°æ®é¢„å¤„ç†
    self.data = self.preprocess_data(data)
    
    # 4. è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
    self.calculate_indicators()
    
    # 5. æ‰§è¡Œå›æµ‹å¾ªç¯ (æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°)
    self._execute_backtest_loop()
    
    # 6. ç”Ÿæˆäº¤æ˜“å›¾è¡¨
    self.plot_trading_chart()
    
    # 7. è¿”å›ç»“æœ
    return self.get_strategy_results()
```

### 3. æ•°æ®è·å–æµç¨‹

```python
# DataManager.get_kline_data() æ–¹æ³•æ‰§è¡Œæµç¨‹
def get_kline_data(self, symbol, start_date, end_date, interval='30m'):
    # 1. ç”Ÿæˆç¼“å­˜æ–‡ä»¶å
    cache_filename = self._generate_cache_filename(
        symbol, start_date, end_date, interval
    )
    
    # 2. æ£€æŸ¥ç¼“å­˜æœ‰æ•ˆæ€§
    if self._is_cache_valid(cache_filename):
        # 3a. ä»ç¼“å­˜åŠ è½½æ•°æ®
        return self._load_from_cache(cache_filename)
    else:
        # 3b. ä»Binance APIè·å–æ•°æ®
        data = self._fetch_from_binance(symbol, start_date, end_date, interval)
        
        # 4. ä¿å­˜åˆ°ç¼“å­˜
        self._save_to_cache(data, cache_filename)
        
        return data
```

## ğŸ“Š æŠ€æœ¯æŒ‡æ ‡ç®—æ³•

### 1. EMA (æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿) ç®—æ³•

#### ç®—æ³•åŸç†
EMAç»™äºˆè¿‘æœŸä»·æ ¼æ›´é«˜çš„æƒé‡ï¼Œå¯¹ä»·æ ¼å˜åŒ–æ›´åŠ æ•æ„Ÿã€‚

#### è®¡ç®—å…¬å¼
```
EMA(t) = Î± Ã— Price(t) + (1-Î±) Ã— EMA(t-1)
```

å…¶ä¸­ï¼š
- `Î± = 2 / (N + 1)` (å¹³æ»‘å› å­)
- `N` = EMAå‘¨æœŸ
- `Price(t)` = å½“å‰ä»·æ ¼
- `EMA(t-1)` = å‰ä¸€æœŸEMAå€¼

#### ä»£ç å®ç°
```python
def calculate_ema(self, data, period):
    """
    è®¡ç®—æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
    
    Args:
        data: ä»·æ ¼æ•°æ®åºåˆ—
        period: EMAå‘¨æœŸ
    
    Returns:
        EMAå€¼åºåˆ—
    """
    return data.ewm(span=period, adjust=False).mean()
```

#### å‚æ•°è¯´æ˜
- **çŸ­æœŸEMA (EMA9)**: å‘¨æœŸ9ï¼Œååº”å¿«é€Ÿä»·æ ¼å˜åŒ–
- **é•¿æœŸEMA (EMA26)**: å‘¨æœŸ26ï¼Œååº”é•¿æœŸè¶‹åŠ¿

### 2. è¶‹åŠ¿å¼ºåº¦ç®—æ³•

#### ç®—æ³•åŸç†
é€šè¿‡è®¡ç®—EMAæ–œç‡æ¥åˆ¤æ–­è¶‹åŠ¿å¼ºåº¦ï¼Œè¿‡æ»¤å¼±åŠ¿ä¿¡å·ã€‚

#### è®¡ç®—å…¬å¼
```python
def calculate_trend_strength(self, ema_values, lookback_periods=5):
    """
    è®¡ç®—è¶‹åŠ¿å¼ºåº¦
    
    è¶‹åŠ¿å¼ºåº¦ = (å½“å‰EMA - NæœŸå‰EMA) / NæœŸå‰EMA
    """
    if len(ema_values) < lookback_periods:
        return 0.0
    
    current_ema = ema_values.iloc[-1]
    past_ema = ema_values.iloc[-lookback_periods]
    
    return (current_ema - past_ema) / past_ema
```

## ğŸ”„ ç­–ç•¥ç®—æ³•è¯¦è§£

### 1. ç®€å•EMAäº¤å‰ç­–ç•¥

#### ä¿¡å·ç”Ÿæˆç®—æ³•
```python
def detect_ema_crossover(self, ema_short, ema_long):
    """
    æ£€æµ‹EMAäº¤å‰ä¿¡å·
    
    Returns:
        'long': EMA9ä¸Šç©¿EMA26 (é‡‘å‰)
        'short': EMA9ä¸‹ç©¿EMA26 (æ­»å‰)
        None: æ— äº¤å‰
    """
    if len(ema_short) < 2 or len(ema_long) < 2:
        return None
    
    # å½“å‰çŠ¶æ€
    current_short = ema_short.iloc[-1]
    current_long = ema_long.iloc[-1]
    
    # å‰ä¸€çŠ¶æ€
    prev_short = ema_short.iloc[-2]
    prev_long = ema_long.iloc[-2]
    
    # æ£€æµ‹äº¤å‰
    if prev_short <= prev_long and current_short > current_long:
        return 'long'  # é‡‘å‰
    elif prev_short >= prev_long and current_short < current_long:
        return 'short'  # æ­»å‰
    
    return None
```

#### ä»“ä½ç®¡ç†ç®—æ³•
```python
def calculate_position_size(self, signal_type):
    """
    è®¡ç®—ä»“ä½å¤§å°
    
    ä»“ä½å¤§å° = å¯ç”¨èµ„é‡‘ Ã— ä»“ä½æ¯”ä¾‹ Ã— æ æ†å€æ•° / å½“å‰ä»·æ ¼
    """
    available_capital = self.capital * self.position_percentage
    position_value = available_capital * self.leverage
    position_size = position_value / self.current_price
    
    return position_size
```

### 2. åˆ†æ‰¹å…¥åœºç­–ç•¥ç®—æ³•

#### åˆ†æ‰¹æ¯”ä¾‹ç®—æ³•
```python
# é»˜è®¤åˆ†æ‰¹æ¯”ä¾‹: [37%, 1%, 2%, 4%, 8%, 16%, 32%]
staged_entry_percentages = [0.37, 0.01, 0.02, 0.04, 0.08, 0.16, 0.32]
```

#### åˆ†æ‰¹å…¥åœºæ¡ä»¶ç®—æ³•
```python
def check_staged_entry_condition(self, entry_price, current_price, direction):
    """
    æ£€æŸ¥åˆ†æ‰¹å…¥åœºæ¡ä»¶
    
    Args:
        entry_price: åˆå§‹å…¥åœºä»·æ ¼
        current_price: å½“å‰ä»·æ ¼
        direction: äº¤æ˜“æ–¹å‘ ('long' or 'short')
    
    Returns:
        bool: æ˜¯å¦æ»¡è¶³åˆ†æ‰¹å…¥åœºæ¡ä»¶
    """
    price_deviation = abs(current_price - entry_price) / entry_price
    
    # ä»·æ ¼åç¦»è¶…è¿‡1%æ—¶è§¦å‘åˆ†æ‰¹å…¥åœº
    if price_deviation > 0.01:
        if direction == 'long' and current_price < entry_price:
            return True  # åšå¤šæ—¶ä»·æ ¼ä¸‹è·Œ
        elif direction == 'short' and current_price > entry_price:
            return True  # åšç©ºæ—¶ä»·æ ¼ä¸Šæ¶¨
    
    return False
```

#### åˆ†æ‰¹ä»“ä½è®¡ç®—ç®—æ³•
```python
def calculate_staged_position(self, stage_index):
    """
    è®¡ç®—åˆ†æ‰¹ä»“ä½å¤§å°
    
    Args:
        stage_index: åˆ†æ‰¹é˜¶æ®µç´¢å¼• (0-6)
    
    Returns:
        float: è¯¥é˜¶æ®µçš„ä»“ä½å¤§å°
    """
    if stage_index >= len(self.staged_entry_percentages):
        return 0
    
    stage_percentage = self.staged_entry_percentages[stage_index]
    available_capital = self.capital * self.position_percentage
    stage_capital = available_capital * stage_percentage
    
    return stage_capital * self.leverage / self.current_price
```

### 3. å¤æ‚EMAç­–ç•¥ç®—æ³•

#### å¤šé‡é€€å‡ºæ¡ä»¶ç®—æ³•
```python
def check_exit_conditions(self, current_price, current_bar):
    """
    æ£€æŸ¥å¤šé‡é€€å‡ºæ¡ä»¶
    
    é€€å‡ºæ¡ä»¶:
    1. EMAåå‘äº¤å‰
    2. çªç ´å…¥åœºäº¤å‰ä»·ä½
    3. çªç ´EMA9ä¸”å¹…åº¦è¶…è¿‡é˜ˆå€¼
    4. çªç ´å‰æœŸç»¿/çº¢Kçº¿
    """
    exit_reasons = []
    
    # æ¡ä»¶1: EMAåå‘äº¤å‰
    if self._check_reverse_crossover():
        exit_reasons.append("EMAåå‘äº¤å‰")
    
    # æ¡ä»¶2: çªç ´å…¥åœºäº¤å‰ä»·ä½
    if self._check_entry_crossover_break(current_price):
        exit_reasons.append("çªç ´å…¥åœºäº¤å‰ä»·ä½")
    
    # æ¡ä»¶3: çªç ´EMA9ä¸”å¹…åº¦è¶…è¿‡é˜ˆå€¼
    if self._check_ema9_break_with_amplitude(current_price):
        exit_reasons.append("çªç ´EMA9ä¸”å¹…åº¦è¶…è¿‡é˜ˆå€¼")
    
    # æ¡ä»¶4: çªç ´å‰æœŸç»¿/çº¢Kçº¿
    if self._check_candle_break(current_bar):
        exit_reasons.append("çªç ´å‰æœŸKçº¿")
    
    return exit_reasons
```

### 4. é«˜çº§åˆ†æ‰¹ç­–ç•¥ç®—æ³•

#### æœ€ä¼˜å…¥åœºç‚¹ç®—æ³•
```python
def find_optimal_entry_point(self, hourly_bar, minute_klines):
    """
    åœ¨1å°æ—¶Kçº¿å†…å¯»æ‰¾æœ€ä¼˜å…¥åœºç‚¹
    
    ç®—æ³•é€»è¾‘:
    1. è·å–è¯¥å°æ—¶å†…çš„æ‰€æœ‰1åˆ†é’ŸKçº¿
    2. æ ¹æ®äº¤æ˜“æ–¹å‘å¯»æ‰¾æœ€ä¼˜ä»·æ ¼
    3. åšå¤š: å¯»æ‰¾æœ€ä½ä»·
    4. åšç©º: å¯»æ‰¾æœ€é«˜ä»·
    """
    hour_start = hourly_bar.name
    hour_end = hour_start + pd.Timedelta(hours=1)
    
    # ç­›é€‰è¯¥å°æ—¶å†…çš„1åˆ†é’Ÿæ•°æ®
    hour_minutes = minute_klines[
        (minute_klines.index >= hour_start) & 
        (minute_klines.index < hour_end)
    ]
    
    if hour_minutes.empty:
        return hourly_bar['close']
    
    # æ ¹æ®æ–¹å‘é€‰æ‹©æœ€ä¼˜ä»·æ ¼
    if self.current_direction == 'long':
        return hour_minutes['low'].min()  # åšå¤šé€‰æœ€ä½ä»·
    else:
        return hour_minutes['high'].max()  # åšç©ºé€‰æœ€é«˜ä»·
```

## ğŸ›¡ï¸ é£é™©æ§åˆ¶ç®—æ³•

### 1. çˆ†ä»“æ£€æµ‹ç®—æ³•

#### çˆ†ä»“æ¡ä»¶è®¡ç®—
```python
def check_liquidation(self, current_price):
    """
    æ£€æµ‹æ˜¯å¦è§¦å‘çˆ†ä»“
    
    çˆ†ä»“æ¡ä»¶:
    æµ®åŠ¨äºæŸ >= æŠ•å…¥ä¿è¯é‡‘ Ã— (1 - ç»´æŒä¿è¯é‡‘ç‡)
    """
    if not self.current_position:
        return False
    
    # è®¡ç®—æµ®åŠ¨ç›ˆäº
    direction_multiplier = 1 if self.current_direction == 'long' else -1
    unrealized_pnl = (
        (current_price - self.average_entry_price) * 
        self.current_position_size * 
        direction_multiplier
    )
    
    # è®¡ç®—çˆ†ä»“é˜ˆå€¼
    liquidation_threshold = (
        self.current_stage_capital_allocated * 
        (1 - self.maintenance_margin_rate)
    )
    
    # åˆ¤æ–­æ˜¯å¦çˆ†ä»“
    return unrealized_pnl <= -liquidation_threshold
```

### 2. ä»“ä½é£é™©æ§åˆ¶ç®—æ³•

#### æœ€å¤§ä»“ä½é™åˆ¶
```python
def validate_position_size(self, new_position_size):
    """
    éªŒè¯ä»“ä½å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶
    
    é™åˆ¶æ¡ä»¶:
    1. å•æ¬¡ä»“ä½ä¸è¶…è¿‡æ€»èµ„é‡‘çš„95%
    2. æ€»ä»“ä½ä¸è¶…è¿‡æ æ†é™åˆ¶
    """
    max_position_value = self.capital * self.position_percentage
    new_position_value = new_position_size * self.current_price
    
    if new_position_value > max_position_value:
        return False
    
    return True
```

### 3. èµ„é‡‘ç®¡ç†ç®—æ³•

#### åŠ¨æ€èµ„é‡‘åˆ†é…
```python
def allocate_capital_for_stage(self, stage_index):
    """
    ä¸ºåˆ†æ‰¹å…¥åœºé˜¶æ®µåˆ†é…èµ„é‡‘
    
    ç®—æ³•:
    1. è®¡ç®—è¯¥é˜¶æ®µåº”åˆ†é…çš„èµ„é‡‘æ¯”ä¾‹
    2. åŸºäºå½“å‰å¯ç”¨èµ„é‡‘è®¡ç®—å®é™…åˆ†é…é‡‘é¢
    3. è€ƒè™‘æ æ†å€æ•°çš„å½±å“
    """
    if stage_index >= len(self.staged_entry_percentages):
        return 0
    
    stage_percentage = self.staged_entry_percentages[stage_index]
    available_capital = self.capital * self.position_percentage
    stage_capital = available_capital * stage_percentage
    
    # è®°å½•åˆ†é…çš„èµ„é‡‘
    self.current_stage_capital_allocated += stage_capital
    
    return stage_capital
```

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°ç®—æ³•

### 1. æ”¶ç›Šç‡è®¡ç®—ç®—æ³•

#### æ€»æ”¶ç›Šç‡
```python
def calculate_total_return(self):
    """
    è®¡ç®—æ€»æ”¶ç›Šç‡
    
    æ€»æ”¶ç›Šç‡ = (æœ€ç»ˆèµ„é‡‘ - åˆå§‹èµ„é‡‘) / åˆå§‹èµ„é‡‘
    """
    return (self.capital - self.initial_capital) / self.initial_capital
```

#### å¹´åŒ–æ”¶ç›Šç‡
```python
def calculate_annualized_return(self, total_return, days):
    """
    è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡
    
    å¹´åŒ–æ”¶ç›Šç‡ = (1 + æ€»æ”¶ç›Šç‡)^(365/å¤©æ•°) - 1
    """
    return (1 + total_return) ** (365 / days) - 1
```

### 2. é£é™©æŒ‡æ ‡ç®—æ³•

#### æœ€å¤§å›æ’¤è®¡ç®—
```python
def calculate_max_drawdown(self, capital_curve):
    """
    è®¡ç®—æœ€å¤§å›æ’¤
    
    æœ€å¤§å›æ’¤ = max((å³°å€¼ - è°·å€¼) / å³°å€¼)
    """
    peak = capital_curve.expanding().max()
    drawdown = (peak - capital_curve) / peak
    return drawdown.max()
```

#### å¤æ™®æ¯”ç‡è®¡ç®—
```python
def calculate_sharpe_ratio(self, returns, risk_free_rate=0.02):
    """
    è®¡ç®—å¤æ™®æ¯”ç‡
    
    å¤æ™®æ¯”ç‡ = (å¹´åŒ–æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / æ”¶ç›Šæ³¢åŠ¨ç‡
    """
    excess_return = returns.mean() - risk_free_rate / 252  # æ—¥æ— é£é™©åˆ©ç‡
    volatility = returns.std()
    
    if volatility == 0:
        return 0
    
    return excess_return / volatility * np.sqrt(252)  # å¹´åŒ–
```

### 3. äº¤æ˜“ç»Ÿè®¡ç®—æ³•

#### èƒœç‡è®¡ç®—
```python
def calculate_win_rate(self, trades):
    """
    è®¡ç®—èƒœç‡
    
    èƒœç‡ = ç›ˆåˆ©äº¤æ˜“æ•° / æ€»äº¤æ˜“æ•°
    """
    if not trades:
        return 0
    
    winning_trades = sum(1 for trade in trades if trade['profit'] > 0)
    return winning_trades / len(trades)
```

#### ç›ˆäºæ¯”è®¡ç®—
```python
def calculate_profit_loss_ratio(self, trades):
    """
    è®¡ç®—ç›ˆäºæ¯”
    
    ç›ˆäºæ¯” = å¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ
    """
    profits = [trade['profit'] for trade in trades if trade['profit'] > 0]
    losses = [abs(trade['profit']) for trade in trades if trade['profit'] < 0]
    
    if not profits or not losses:
        return 0
    
    avg_profit = sum(profits) / len(profits)
    avg_loss = sum(losses) / len(losses)
    
    return avg_profit / avg_loss if avg_loss > 0 else 0
```

## ğŸ”„ æ•°æ®å¤„ç†ç®—æ³•

### 1. æ•°æ®é‡é‡‡æ ·ç®—æ³•

#### 1åˆ†é’Ÿåˆ°30åˆ†é’Ÿé‡é‡‡æ ·
```python
def resample_to_30min(self, klines_1min):
    """
    å°†1åˆ†é’ŸKçº¿é‡é‡‡æ ·ä¸º30åˆ†é’ŸKçº¿
    
    é‡é‡‡æ ·è§„åˆ™:
    - open: å–ç¬¬ä¸€ä¸ªå€¼
    - high: å–æœ€å¤§å€¼
    - low: å–æœ€å°å€¼
    - close: å–æœ€åä¸ªå€¼
    - volume: æ±‚å’Œ
    """
    resampling_rules = {
        'open': 'first',
        'high': 'max',
        'low': 'min',
        'close': 'last',
        'volume': 'sum'
    }
    
    # è®¾ç½®æ—¶é—´ç´¢å¼•
    klines_1min['timestamp'] = pd.to_datetime(klines_1min['timestamp'])
    klines_1min.set_index('timestamp', inplace=True)
    
    # æ‰§è¡Œé‡é‡‡æ ·
    klines_30min = klines_1min.resample('30T').agg(resampling_rules)
    
    # ç§»é™¤ç©ºå€¼
    klines_30min = klines_30min.dropna()
    
    return klines_30min
```

### 2. æ•°æ®ç¼“å­˜ç®—æ³•

#### ç¼“å­˜æœ‰æ•ˆæ€§æ£€æŸ¥
```python
def is_cache_valid(self, cache_file, max_age_hours=24):
    """
    æ£€æŸ¥ç¼“å­˜æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆ
    
    Args:
        cache_file: ç¼“å­˜æ–‡ä»¶è·¯å¾„
        max_age_hours: æœ€å¤§ç¼“å­˜æ—¶é—´(å°æ—¶)
    
    Returns:
        bool: ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    """
    if not os.path.exists(cache_file):
        return False
    
    file_age = time.time() - os.path.getmtime(cache_file)
    max_age_seconds = max_age_hours * 3600
    
    return file_age < max_age_seconds
```

### 3. æ•°æ®éªŒè¯ç®—æ³•

#### Kçº¿æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
```python
def validate_kline_data(self, klines):
    """
    éªŒè¯Kçº¿æ•°æ®çš„å®Œæ•´æ€§
    
    æ£€æŸ¥é¡¹ç›®:
    1. å¿…è¦å­—æ®µæ˜¯å¦å­˜åœ¨
    2. æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®
    3. ä»·æ ¼å…³ç³»æ˜¯å¦åˆç† (high >= low, open/closeåœ¨high-lowèŒƒå›´å†…)
    4. æ—¶é—´åºåˆ—æ˜¯å¦è¿ç»­
    """
    required_columns = ['timestamp', 'open', 'high', 'low', 'close', 'volume']
    
    # æ£€æŸ¥å¿…è¦å­—æ®µ
    for col in required_columns:
        if col not in klines.columns:
            raise ValueError(f"ç¼ºå°‘å¿…è¦å­—æ®µ: {col}")
    
    # æ£€æŸ¥ä»·æ ¼å…³ç³»
    invalid_rows = klines[
        (klines['high'] < klines['low']) |
        (klines['open'] > klines['high']) |
        (klines['open'] < klines['low']) |
        (klines['close'] > klines['high']) |
        (klines['close'] < klines['low'])
    ]
    
    if not invalid_rows.empty:
        raise ValueError(f"å‘ç° {len(invalid_rows)} è¡Œæ— æ•ˆçš„ä»·æ ¼æ•°æ®")
    
    return True
```

## ğŸ”§ ç®—æ³•ä¼˜åŒ–ä¸ä¿®å¤è®°å½•

### 1. åˆ†æ‰¹ç­–ç•¥æ€§èƒ½æŒ‡æ ‡ä¿®å¤ (2024å¹´12æœˆ)

#### é—®é¢˜æè¿°
åˆ†æ‰¹ç­–ç•¥ï¼ˆStagedEMAï¼‰çš„æ€§èƒ½æŒ‡æ ‡è®¡ç®—å­˜åœ¨é”™è¯¯ï¼š
- å¹³å‡æ”¶ç›Šç‡ã€æœ€å¤§å•ç¬”ç›ˆåˆ©ã€æœ€å¤§å•ç¬”äºæŸåŸºäºå•ä¸ªåˆ†æ‰¹è®°å½•è®¡ç®—
- åº”è¯¥åŸºäºå®Œæ•´äº¤æ˜“ï¼ˆæ‰€æœ‰åˆ†æ‰¹è®°å½•çš„æ€»å’Œï¼‰è®¡ç®—

#### ä¿®å¤æ–¹æ¡ˆ

**1. åˆ©æ¶¦åˆ†é…ä¿®å¤**
```python
# ä¿®å¤å‰ï¼šæ¯ä¸ªåˆ†æ‰¹è®°å½•éƒ½æœ‰åˆ©æ¶¦
for stage in stages:
    stage['profit'] = stage_profit  # é”™è¯¯ï¼šé‡å¤è®¡ç®—

# ä¿®å¤åï¼šåªæœ‰åˆå§‹è®°å½•æœ‰æ€»åˆ©æ¶¦
initial_record['profit'] = total_profit
for subsequent_record in subsequent_records:
    subsequent_record['profit'] = 0  # åç»­è®°å½•åˆ©æ¶¦ä¸º0
```

**2. æ€§èƒ½æŒ‡æ ‡è®¡ç®—ä¿®å¤**
```python
# ä¿®å¤å‰ï¼šåŸºäºæ‰€æœ‰è®°å½•è®¡ç®—ï¼ˆåŒ…å«é‡å¤ï¼‰
all_profits = [trade['profit'] for trade in detailed_trades]

# ä¿®å¤åï¼šåŸºäºå®Œæ•´äº¤æ˜“è®¡ç®—
complete_trades = self._group_trades_by_complete_transactions()
trade_profits = [trade['total_profit'] for trade in complete_trades]
```

#### ä¿®å¤æ•ˆæœå¯¹æ¯”
| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| å¹³å‡æ”¶ç›Šç‡ | 0.14% | 2.59% |
| æœ€å¤§å•ç¬”ç›ˆåˆ© | 2.25% | 41.54% |
| æœ€å¤§å•ç¬”äºæŸ | -1.15% | -21.25% |
| æ€»æ”¶ç›Šç‡ | 1529.63% | 1529.63% (ä¸å˜) |
| æœ€ç»ˆèµ„é‡‘ | $162963.09 | $162963.09 (ä¸å˜) |

### 2. èµ„é‡‘ç®¡ç†ç®—æ³•ä¼˜åŒ–

#### æœ€ç»ˆèµ„é‡‘è®¡ç®—æµç¨‹
```python
def calculate_final_capital(self):
    """
    æœ€ç»ˆèµ„é‡‘è®¡ç®—æµç¨‹
    
    æœ€ç»ˆèµ„é‡‘ = åˆå§‹èµ„é‡‘ + æ‰€æœ‰äº¤æ˜“çš„å‡€ç›ˆäº - æ‰€æœ‰æ‰‹ç»­è´¹
    """
    # 1. åˆå§‹èµ„é‡‘è®¾ç½®
    self.capital = self.initial_capital
    
    # 2. å¼€ä»“æ—¶ï¼šæ‰£é™¤æ‰‹ç»­è´¹
    self.capital -= fee_cost
    
    # 3. åŠ ä»“æ—¶ï¼šæ‰£é™¤æ‰‹ç»­è´¹
    self.capital -= additional_fee_cost
    
    # 4. å¹³ä»“æ—¶ï¼šå½’è¿˜æœ¬é‡‘ + ç›ˆäº - å¹³ä»“æ‰‹ç»­è´¹
    self.capital += current_stage_capital_allocated + total_profit - closing_fee
    
    return self.capital
```

### 3. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### å·²å®ç°çš„ä¼˜åŒ–
1. **å‘é‡åŒ–è®¡ç®—**: ä½¿ç”¨pandasçš„å‘é‡åŒ–æ“ä½œæ›¿ä»£å¾ªç¯
2. **æ•°æ®ç¼“å­˜**: å®ç°æ™ºèƒ½ç¼“å­˜æœºåˆ¶å‡å°‘APIè°ƒç”¨
3. **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®å¯¹è±¡
4. **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

#### å»ºè®®çš„è¿›ä¸€æ­¥ä¼˜åŒ–
1. **å¹¶è¡Œè®¡ç®—**: å¤šç­–ç•¥å¹¶è¡Œæ‰§è¡Œ
2. **å¢é‡è®¡ç®—**: å®ç°æŒ‡æ ‡çš„å¢é‡æ›´æ–°
3. **æ•°æ®å‹ç¼©**: ä¼˜åŒ–ç¼“å­˜æ–‡ä»¶çš„å­˜å‚¨æ ¼å¼
4. **æ™ºèƒ½å‚æ•°è°ƒä¼˜**: å¼•å…¥é—ä¼ ç®—æ³•ç­‰ä¼˜åŒ–æ–¹æ³•

### 4. ä»£ç è´¨é‡æå‡

#### é‡æ„æˆæœ
1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ¥å£å®šä¹‰
2. **é…ç½®ç®¡ç†**: ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶å’Œå‚æ•°ç®¡ç†
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œå¤„ç†æœºåˆ¶
4. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’ŒAPIæ–‡æ¡£

#### æµ‹è¯•è¦†ç›–
1. **å•å…ƒæµ‹è¯•**: æ ¸å¿ƒç®—æ³•çš„å•å…ƒæµ‹è¯•è¦†ç›–
2. **é›†æˆæµ‹è¯•**: ç«¯åˆ°ç«¯çš„ç­–ç•¥è¿è¡Œæµ‹è¯•
3. **æ€§èƒ½æµ‹è¯•**: å¤§æ•°æ®é‡ä¸‹çš„æ€§èƒ½éªŒè¯
4. **å›å½’æµ‹è¯•**: ç¡®ä¿ä¿®å¤ä¸å¼•å…¥æ–°é—®é¢˜

---

## ğŸ“Š è¯¦ç»†äº¤æ˜“æ—¥å¿—è¾“å‡ºæ ¼å¼

### 1. å®æ—¶äº¤æ˜“æ—¥å¿—

åˆ†æ‰¹å…¥åœºç­–ç•¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºè¯¦ç»†çš„å®æ—¶äº¤æ˜“ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯æ¬¡å…¥åœºã€åŠ ä»“å’Œå¹³ä»“çš„è¯¦ç»†æ•°æ®ï¼š

#### 1.1 åˆå§‹å…¥åœºæ—¥å¿—æ ¼å¼
```
================================================================================
ğŸ“ˆ ç¬¬Næ¬¡äº¤æ˜“ - åˆå§‹å…¥åœº LONG/SHORT
================================================================================
ğŸ“… æ—¶é—´: 2024-10-03 20:30:00
ğŸ’° å½“å‰èµ„é‡‘: $10000.00
ğŸ“ˆ å…¥åœºä»·æ ¼: $60800.00
ğŸ’µ æœ¬æ¬¡æŠ•å…¥: $3700.00
ğŸ“Š æœ¬æ¬¡ä»“ä½: 0.060855
ğŸ’¸ æ‰‹ç»­è´¹: $1.48
ğŸ¯ æ æ†å€æ•°: 1.0x
ğŸ“‹ åˆ†æ‰¹é˜¶æ®µ: 1/7
================================================================================
```

#### 1.2 åŠ ä»“æ—¥å¿—æ ¼å¼
```
================================================================================
ğŸ“ˆ ç¬¬Næ¬¡äº¤æ˜“ - ç¬¬Mæ¬¡åŠ ä»“ LONG/SHORT
================================================================================
ğŸ“… æ—¶é—´: 2024-10-03 20:31:00
ğŸ’° å½“å‰èµ„é‡‘: $9991.84
ğŸ“ˆ åŠ ä»“ä»·æ ¼: $60759.99
ğŸ’µ æœ¬æ¬¡æŠ•å…¥: $100.00
ğŸ“Š æœ¬æ¬¡ä»“ä½: 0.001646
ğŸ’¸ æ‰‹ç»­è´¹: $0.04
ğŸ”„ ç´¯è®¡æŠ•å…¥: $3800.00
ğŸ“Š æ€»ä»“ä½: 0.062499
ğŸ’¹ å¹³å‡ä»·æ ¼: $60800.89
ğŸ“‹ åˆ†æ‰¹é˜¶æ®µ: 2/7
================================================================================
```

#### 1.3 å¹³ä»“æ—¥å¿—æ ¼å¼
```
================================================================================
ğŸ”š ç¬¬Næ¬¡äº¤æ˜“ - å…¨éƒ¨å¹³ä»“ LONG/SHORT (åŸå› : EMAåå‘äº¤å‰)
================================================================================
ğŸ“… æ—¶é—´: 2024-10-03 21:00:00
ğŸ“‰ å¹³ä»“ä»·æ ¼: $61200.00
ğŸ“Š å¹³ä»“ä»“ä½: 0.072382
ğŸ’° å¹³ä»“å‰èµ„é‡‘: $9991.44
ğŸ’¸ æ‰‹ç»­è´¹: $1.77
ğŸ’µ æ€»æŠ•å…¥: $4400.00
ğŸ’¹ æ€»ç›ˆäº: $289.45
ğŸ“Š æ”¶ç›Šç‡: 6.58%
ğŸ’° å¹³ä»“åèµ„é‡‘: $10279.12
================================================================================
```

### 2. ç­–ç•¥å®Œæˆåçš„è¯¦ç»†äº¤æ˜“æ±‡æ€»

ç­–ç•¥è¿è¡Œå®Œæˆåï¼Œç³»ç»Ÿä¼šè¾“å‡ºä¸€ä¸ªå®Œæ•´çš„äº¤æ˜“æ±‡æ€»ï¼ŒæŒ‰äº¤æ˜“IDåˆ†ç»„æ˜¾ç¤ºæ¯ç¬”å®Œæ•´äº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯ï¼š

#### 2.1 æ±‡æ€»æ ¼å¼ç¤ºä¾‹
```
================================================================================
ğŸ“Š è¯¦ç»†äº¤æ˜“æ±‡æ€» - å…±18ç¬”å®Œæ•´äº¤æ˜“
================================================================================

ğŸ”¸ ç¬¬1æ¬¡äº¤æ˜“ (LONG) - âœ… ç›ˆåˆ©
   ğŸ“… äº¤æ˜“æ—¶é—´: 2024-10-01 14:00:00 â†’ 2024-10-01 20:00:00
   ğŸ’µ æ€»æŠ•å…¥: $4400.00
   ğŸ’¹ æ€»ç›ˆäº: $289.45
   ğŸ“Š æ”¶ç›Šç‡: 6.58%
   ğŸ“‹ åˆ†æ‰¹æ¬¡æ•°: 4æ¬¡
      â””â”€ åˆå§‹å…¥åœº: æŠ•å…¥$3700.00, ç›ˆäº$243.21, ä»·æ ¼$60800.00â†’$61200.00
      â””â”€ ç¬¬1æ¬¡åŠ ä»“: æŠ•å…¥$100.00, ç›ˆäº$6.57, ä»·æ ¼$60759.99â†’$61200.00
      â””â”€ ç¬¬2æ¬¡åŠ ä»“: æŠ•å…¥$200.00, ç›ˆäº$13.15, ä»·æ ¼$60745.28â†’$61200.00
      â””â”€ ç¬¬3æ¬¡åŠ ä»“: æŠ•å…¥$400.00, ç›ˆäº$26.52, ä»·æ ¼$60691.44â†’$61200.00

ğŸ”¸ ç¬¬2æ¬¡äº¤æ˜“ (SHORT) - âŒ äºæŸ
   ğŸ“… äº¤æ˜“æ—¶é—´: 2024-10-01 20:00:00 â†’ 2024-10-02 02:00:00
   ğŸ’µ æ€»æŠ•å…¥: $3700.00
   ğŸ’¹ æ€»ç›ˆäº: $-45.23
   ğŸ“Š æ”¶ç›Šç‡: -1.22%
   ğŸ“‹ åˆ†æ‰¹æ¬¡æ•°: 1æ¬¡
      â””â”€ åˆå§‹å…¥åœº: æŠ•å…¥$3700.00, ç›ˆäº$-45.23, ä»·æ ¼$61200.00â†’$61950.00
```

#### 2.2 å­—æ®µè¯´æ˜

**äº¤æ˜“çŠ¶æ€æ ‡è¯†**ï¼š
- âœ… ç›ˆåˆ©ï¼šç»¿è‰²æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥ç¬”äº¤æ˜“è·å¾—æ­£æ”¶ç›Š
- âŒ äºæŸï¼šçº¢è‰²æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥ç¬”äº¤æ˜“äº§ç”ŸäºæŸ
- âš–ï¸ æŒå¹³ï¼šé»„è‰²æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥ç¬”äº¤æ˜“æ”¶ç›Šä¸ºé›¶

**å…³é”®æŒ‡æ ‡**ï¼š
- **äº¤æ˜“æ—¶é—´**ï¼šä»é¦–æ¬¡å…¥åœºåˆ°æœ€ç»ˆå¹³ä»“çš„æ—¶é—´èŒƒå›´
- **æ€»æŠ•å…¥**ï¼šè¯¥ç¬”äº¤æ˜“çš„ç´¯è®¡æŠ•å…¥èµ„é‡‘
- **æ€»ç›ˆäº**ï¼šè¯¥ç¬”äº¤æ˜“çš„å‡€ç›ˆäºé‡‘é¢ï¼ˆå·²æ‰£é™¤æ‰‹ç»­è´¹ï¼‰
- **æ”¶ç›Šç‡**ï¼šç›ˆäºé‡‘é¢ç›¸å¯¹äºæ€»æŠ•å…¥çš„ç™¾åˆ†æ¯”
- **åˆ†æ‰¹æ¬¡æ•°**ï¼šè¯¥ç¬”äº¤æ˜“åŒ…å«çš„åˆ†æ‰¹å…¥åœºæ¬¡æ•°

**åˆ†æ‰¹è¯¦æƒ…**ï¼š
- **æŠ•å…¥é‡‘é¢**ï¼šæ¯ä¸ªåˆ†æ‰¹çš„èµ„é‡‘æŠ•å…¥
- **ç›ˆäºé‡‘é¢**ï¼šæ¯ä¸ªåˆ†æ‰¹çš„å‡€ç›ˆäºï¼ˆæŒ‰èµ„é‡‘åˆ†é…æ¯”ä¾‹è®¡ç®—ï¼‰
- **ä»·æ ¼å˜åŒ–**ï¼šä»å…¥åœºä»·æ ¼åˆ°å¹³ä»“ä»·æ ¼çš„å˜åŒ–

### 3. è¾“å‡ºæ–‡ä»¶è¯´æ˜

é™¤äº†æ§åˆ¶å°è¾“å‡ºå¤–ï¼Œç³»ç»Ÿè¿˜ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

#### 3.1 è¯¦ç»†äº¤æ˜“è®°å½•JSONæ–‡ä»¶
- **æ–‡ä»¶è·¯å¾„**ï¼š`output/trades_detailed_log_{ç­–ç•¥å}.json`
- **å†…å®¹**ï¼šåŒ…å«æ‰€æœ‰äº¤æ˜“çš„å®Œæ•´æ•°æ®ï¼Œå¯ç”¨äºåç»­åˆ†æ
- **æ ¼å¼**ï¼šç»“æ„åŒ–JSONæ ¼å¼ï¼ŒåŒ…å«æ—¶é—´æˆ³ã€ä»·æ ¼ã€ä»“ä½ã€ç›ˆäºç­‰è¯¦ç»†ä¿¡æ¯

#### 3.2 å›¾è¡¨æ–‡ä»¶
- **äº¤æ˜“å›¾è¡¨**ï¼š`output/charts/{ç­–ç•¥å}_30min_äº¤æ˜“å›¾è¡¨.png`
- **åˆ†æå›¾è¡¨**ï¼š`output/charts/{ç­–ç•¥å}_äº¤æ˜“åˆ†æ.png`
- **å†…å®¹**ï¼šå¯è§†åŒ–çš„äº¤æ˜“ä¿¡å·ã€ä»·æ ¼èµ°åŠ¿å’Œä»“ä½å˜åŒ–

### 4. æ—¥å¿—çº§åˆ«é…ç½®

å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ï¼š

```json
{
  "logging": {
    "enable_detailed_log": true,        // å¯ç”¨è¯¦ç»†æ—¥å¿—
    "log_trades_to_file": true,         // ä¿å­˜äº¤æ˜“è®°å½•åˆ°æ–‡ä»¶
    "log_file_prefix": "trades_detailed_log",  // æ—¥å¿—æ–‡ä»¶å‰ç¼€
    "log_level": "INFO"                 // æ—¥å¿—çº§åˆ«
  }
}
```

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.3 (2024å¹´12æœˆ)
- **ä¸»è¦æ›´æ–°**: åˆ†æ‰¹ç­–ç•¥æ€§èƒ½æŒ‡æ ‡ä¿®å¤
- **ä¿®å¤å†…å®¹**: 
  - ä¿®æ­£åˆ©æ¶¦åˆ†é…é€»è¾‘ï¼Œé¿å…é‡å¤è®¡ç®—
  - ä¼˜åŒ–æ€§èƒ½æŒ‡æ ‡è®¡ç®—ï¼ŒåŸºäºå®Œæ•´äº¤æ˜“ç»Ÿè®¡
  - å®Œå–„èµ„é‡‘ç®¡ç†æµç¨‹ï¼Œç¡®ä¿èµ„é‡‘æµè½¬æ­£ç¡®
- **æ–°å¢åŠŸèƒ½**: 
  - å¢å¼ºçš„äº¤æ˜“è®°å½•ç®¡ç†
  - æ”¹è¿›çš„å›¾è¡¨ç”ŸæˆåŠŸèƒ½
  - æ›´å‡†ç¡®çš„æ€§èƒ½è¯„ä¼°æŒ‡æ ‡

### v1.2 (2024å¹´11æœˆ)
- **ä¸»è¦æ›´æ–°**: ç”»å›¾åŠŸèƒ½ç‹¬ç«‹åŒ–ä¼˜åŒ–
- **ä¿®å¤å†…å®¹**: 
  - è§£å†³ä¸åŒç­–ç•¥äº¤æ˜“è®°å½•ç»“æ„å·®å¼‚å¯¼è‡´çš„ç”»å›¾é—®é¢˜
  - ä¸ºæ¯ä¸ªç­–ç•¥åˆ›å»ºç‹¬ç«‹çš„ç”»å›¾æ–¹æ³•
  - ç»Ÿä¸€å›¾è¡¨ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶å‘½åè§„èŒƒ

### v1.1 (2024å¹´10æœˆ)
- **ä¸»è¦æ›´æ–°**: èµ„é‡‘ç®¡ç†ç®—æ³•ä¿®å¤
- **ä¿®å¤å†…å®¹**: 
  - ä¿®å¤SimpleEMAå’ŒComplexEMAç­–ç•¥çš„èµ„é‡‘å½’è¿˜é€»è¾‘
  - è§£å†³èµ„é‡‘é€æ¸å‡å°‘è‡³é›¶çš„é—®é¢˜
  - å¢å¼ºç»Ÿè®¡ç®—æ³•å…¼å®¹æ€§

---

*æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†MyQuantç³»ç»Ÿä¸­ä½¿ç”¨çš„å„ç§ç®—æ³•ï¼ŒåŒ…æ‹¬æœ€æ–°çš„ä¿®å¤å’Œä¼˜åŒ–å†…å®¹ï¼Œä¸ºç³»ç»Ÿçš„ç†è§£ã€ç»´æŠ¤å’Œä¼˜åŒ–æä¾›å…¨é¢çš„æŠ€æœ¯å‚è€ƒã€‚*