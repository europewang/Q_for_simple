# äº¤æ˜“è®°å½•åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç³»ç»Ÿç°åœ¨ä¼šè‡ªåŠ¨å°†æ‰€æœ‰äº¤æ˜“æ“ä½œè®°å½•åˆ° `trade_records.txt` æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬å¼€ä»“ã€å¹³ä»“çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ–¹ä¾¿æ‚¨è·Ÿè¸ªå’Œåˆ†æäº¤æ˜“å†å²ã€‚

**ğŸ†• æ–°å¢åŠŸèƒ½ï¼šåŠ¨æ€äº¤æ˜“é‡‘é¢è°ƒæ•´ (åªå¢ä¸å‡ï¼Œå«ä¿é™©é‡‘æœºåˆ¶)**
- **ä¿®å¤**ï¼šè§£å†³äº† `WebTrader` åˆå§‹åŒ–æ—¶ `max_capital_multiplier_file` å±æ€§æœªåŠæ—¶åˆå§‹åŒ–å¯¼è‡´çš„ `AttributeError`ã€‚ç°åœ¨ï¼Œ`max_capital_multiplier_file`ã€`max_capital_multiplier`ã€`insurance_fund` å’Œ `last_insurance_fund_multiplier_threshold` ç­‰å±æ€§çš„åˆå§‹åŒ–å’ŒåŠ è½½é€»è¾‘å·²æå‰åˆ°ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶åˆå§‹åŒ–ä¹‹å‰ï¼Œç¡®ä¿åœ¨ä»»ä½•ä¾èµ–è¿™äº›å±æ€§çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä»¬éƒ½å·²å‡†å¤‡å°±ç»ªã€‚
- ç³»ç»Ÿç°åœ¨ä¼šç»´æŠ¤ä¸€ä¸ª `capital_multiplier.json` æ–‡ä»¶ï¼ˆä½äº `web_trader.py` åŒçº§ç›®å½•ï¼‰ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨å†å²æœ€å¤§äº¤æ˜“å€æ•°ã€**ä¿é™©é‡‘ (`insurance_fund`) å’Œä¸Šæ¬¡ä¿é™©é‡‘å€æ•°é˜ˆå€¼ (`last_insurance_multiplier_threshold`)**ã€‚
- æ¯æ¬¡å¼€ä»“å‰ï¼Œç³»ç»Ÿä¼šè·å–å½“å‰è´¦æˆ·çš„Uæœ¬ä½æ€»é‡‘é¢ã€‚
- **ä¿é™©é‡‘ç´¯ç§¯æœºåˆ¶**ï¼šå½“å½“å‰èµ„é‡‘ä¸åˆå§‹èµ„é‡‘çš„æ¯”ä¾‹ (`capital_ratio`) è¶…è¿‡ `n.5` å€ï¼ˆä¾‹å¦‚ 1.5, 2.5, 3.5 ç­‰ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šä»å½“å‰èµ„é‡‘ä¸­æå– 1/10 ä½œä¸ºä¿é™©é‡‘ç´¯ç§¯èµ·æ¥ã€‚æ¯ä¸ª `n.5` é˜ˆå€¼åªä¼šè§¦å‘ä¸€æ¬¡ä¿é™©é‡‘ç´¯ç§¯ï¼Œå¹¶é€šè¿‡ `last_insurance_fund_multiplier_threshold` è¿›è¡Œè®°å½•ï¼Œé˜²æ­¢é‡å¤ç´¯ç§¯ã€‚
- æ ¹æ®**æ‰£é™¤ä¿é™©é‡‘åçš„å½“å‰æ€»é‡‘é¢**ä¸åˆå§‹èµ„é‡‘ï¼ˆ`initial_capital`ï¼‰çš„å€æ•°å…³ç³»ï¼ŒåŠ¨æ€è®¡ç®—å‡ºæœ¬æ¬¡äº¤æ˜“çš„ `fixed_trade_amount`ã€‚
- **å…³é”®æ”¹è¿›**ï¼š`capital_multiplier` ç°åœ¨åªå¢ä¸å‡ã€‚ç³»ç»Ÿä¼šæ¯”è¾ƒå½“å‰è®¡ç®—å‡ºçš„å€æ•°ï¼ˆ**åŸºäºæ‰£é™¤ä¿é™©é‡‘åçš„èµ„é‡‘**ï¼‰ä¸ `capital_multiplier.json` ä¸­è®°å½•çš„å†å²æœ€å¤§å€æ•°ï¼Œå§‹ç»ˆä½¿ç”¨ä¸¤è€…ä¸­çš„è¾ƒå¤§å€¼ä½œä¸ºå½“å‰çš„äº¤æ˜“å€æ•°ã€‚
- è°ƒæ•´åçš„ `fixed_trade_amount` å°†ä½œä¸º `WebTrader` å®ä¾‹çš„ `self.current_fixed_trade_amount` å±æ€§ï¼Œç”¨äºæœ¬æ¬¡äº¤æ˜“çš„è®¡ç®—ã€‚
- è¿™æœ‰åŠ©äºåœ¨èµ„é‡‘å¢é•¿æ—¶ï¼ŒæŒ‰æ¯”ä¾‹å¢åŠ æ¯æ¬¡äº¤æ˜“çš„æŠ•å…¥ï¼Œå®ç°èµ„é‡‘çš„æœ‰æ•ˆåˆ©ç”¨ï¼ŒåŒæ—¶é€šè¿‡ä¿é™©é‡‘æœºåˆ¶ï¼Œåœ¨èµ„é‡‘å¿«é€Ÿå¢é•¿æ—¶é¢„ç•™ä¸€éƒ¨åˆ†èµ„é‡‘ä½œä¸ºå®‰å…¨å«ï¼Œé˜²æ­¢å€æ•°å¢é•¿è¿‡å¿«ï¼Œå¹¶é¿å…ç›´æ¥ä¿®æ”¹å…¨å±€é…ç½®ã€‚

**ğŸ†• æ–°å¢åŠŸèƒ½ï¼šåŠ¨æ€æ æ†è°ƒæ•´**
- ç³»ç»Ÿç°åœ¨æ”¯æŒæ ¹æ®äº¤æ˜“ç›ˆäºè‡ªåŠ¨è°ƒæ•´æ æ†å€æ•°
- äºæŸåæ æ†å¢åŠ 2å€ï¼Œç›ˆåˆ©åæ æ†å›å½’åŸºç¡€å€¼25å€
- æ‰€æœ‰æ æ†å˜åŒ–éƒ½ä¼šåœ¨æ—¥å¿—ä¸­è¯¦ç»†è®°å½•

**ğŸ”§ é‡è¦ä¿®å¤ï¼šEMAäº¤å‰æ£€æµ‹é€»è¾‘ä¼˜åŒ–ï¼ˆ2024-12-28ï¼‰**
- **é—®é¢˜æè¿°**ï¼šåŸæœ‰çš„EMAäº¤å‰æ£€æµ‹ä¾èµ–å†å²Kçº¿æ•°æ®æ¯”è¾ƒï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
  - å½“Kçº¿æ•°æ®æ›´æ–°å»¶è¿Ÿæ—¶ï¼Œå¯èƒ½é”™è¿‡çœŸå®çš„EMAäº¤å‰ä¿¡å·
  - å¦‚æœæŸä¸ªåŠå°æ—¶æ£€æµ‹ç‚¹è¢«é—æ¼ï¼Œå¯èƒ½å¯¼è‡´æŒä»“æ–¹å‘ä¸EMAä¿¡å·ä¸åŒ¹é…
  - åŸºäºå‰åä¸¤æ ¹Kçº¿çš„æ¯”è¾ƒæ–¹å¼ä¸å¤Ÿç¨³å®š

- **ä¿®å¤æ–¹æ¡ˆ**ï¼šé‡æ–°è®¾è®¡EMAäº¤å‰æ£€æµ‹é€»è¾‘
  - **æ–°é€»è¾‘**ï¼šåŸºäºå½“å‰EMAä¿¡å·çŠ¶æ€ä¸æŒä»“æ–¹å‘çš„åŒ¹é…åº¦è¿›è¡Œåˆ¤æ–­
  - **æ£€æµ‹åŸç†**ï¼š
    - è·å–å½“å‰EMA9å’ŒEMA26çš„å®æ—¶å€¼
    - åˆ¤æ–­å½“å‰EMAä¿¡å·çŠ¶æ€ï¼ˆå¤šå¤´ï¼šEMA9 > EMA26ï¼Œç©ºå¤´ï¼šEMA9 < EMA26ï¼‰
    - è·å–å½“å‰æŒä»“æ–¹å‘ï¼ˆå¤šå¤´/ç©ºå¤´/æ— æŒä»“ï¼‰
    - å¦‚æœEMAä¿¡å·ä¸æŒä»“æ–¹å‘ä¸åŒ¹é…ï¼Œåˆ™è§¦å‘äº¤æ˜“ä¿¡å·

- **ä¼˜åŠ¿**ï¼š
  - âœ… é¿å…å› åŠå°æ—¶æ£€æµ‹é—æ¼è€Œé”™è¿‡äº¤æ˜“æœºä¼š
  - âœ… ç¡®ä¿æŒä»“æ–¹å‘å§‹ç»ˆä¸å½“å‰EMAä¿¡å·ä¿æŒä¸€è‡´
  - âœ… åŸºäºå½“å‰çŠ¶æ€åˆ¤æ–­ï¼Œä¸ä¾èµ–å†å²æ•°æ®å˜åŒ–
  - âœ… æé«˜äº¤æ˜“ä¿¡å·çš„å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§

- **äº¤æ˜“é€»è¾‘**ï¼š
  - å½“å‰EMAå¤šå¤´ä¿¡å· + æ— æŒä»“/ç©ºå¤´æŒä»“ â†’ æ‰§è¡Œåšå¤šæ“ä½œ
  - å½“å‰EMAç©ºå¤´ä¿¡å· + æ— æŒä»“/å¤šå¤´æŒä»“ â†’ æ‰§è¡Œåšç©ºæ“ä½œ
  - EMAä¿¡å·ä¸æŒä»“æ–¹å‘ä¸€è‡´ â†’ æ— éœ€äº¤æ˜“

**ğŸ›¡ï¸ åŠå°æ—¶æ£€æµ‹ä¿éšœæœºåˆ¶
- **æ£€æµ‹çŠ¶æ€æŒä¹…åŒ–**ï¼šå°†æ£€æµ‹æ—¶é—´è®°å½•ä¿å­˜åˆ° `logs/detection_state.json` æ–‡ä»¶
- **å¯åŠ¨æ—¶æ£€æµ‹æ¢å¤**ï¼šç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶è¡¥å¿é—æ¼çš„æ£€æµ‹ç‚¹
- **ä¿®å¤å¯åŠ¨æ—¶é—æ¼æ£€æŸ¥é”™è¯¯**ï¼šè§£å†³äº† `hour must be in 0..23, not 24` çš„æ—¶é—´å¤„ç†é”™è¯¯ï¼Œç¡®ä¿è·¨åˆå¤œçš„æ£€æµ‹ç‚¹ä¹Ÿèƒ½æ­£ç¡®å¤„ç†ã€‚
- **å®æ—¶çŠ¶æ€ä¿å­˜**ï¼šæ¯æ¬¡æ£€æµ‹å®Œæˆåç«‹å³æ›´æ–°çŠ¶æ€æ–‡ä»¶
- **æ£€æµ‹çª—å£æœºåˆ¶**ï¼šæ¯ä¸ªæ£€æµ‹ç‚¹æœ‰30ç§’çª—å£ï¼Œé˜²é‡å¤æ£€æµ‹
- **è¡¥å¿æ£€æµ‹**ï¼šåŸºäºå½“å‰EMAçŠ¶æ€å’ŒæŒä»“æƒ…å†µè‡ªåŠ¨æ‰§è¡Œé—æ¼çš„æ£€æµ‹
- **å¼‚å¸¸æ¢å¤**ï¼šå³ä½¿ç¨‹åºå¼‚å¸¸é‡å¯ä¹Ÿèƒ½ä¿æŒæ£€æµ‹çš„è¿ç»­æ€§

## ğŸ“„ æ–‡ä»¶ä½ç½®

```
simple_live_trading/trade_records.txt
```

## ğŸ“Š è®°å½•æ ¼å¼

æ¯æ¡äº¤æ˜“è®°å½•åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

```
[æ—¶é—´] æ“ä½œç±»å‹ | äº¤æ˜“å¯¹ | æ–¹å‘ | ä»·æ ¼ | æ•°é‡ | ç›ˆäº | å¤‡æ³¨
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| æ—¶é—´ | äº¤æ˜“æ‰§è¡Œçš„å…·ä½“æ—¶é—´ | `2025-10-12 20:29:30` |
| æ“ä½œç±»å‹ | å¼€ä»“æˆ–å¹³ä»“ | `å¼€ä»“` / `å¹³ä»“` |
| äº¤æ˜“å¯¹ | äº¤æ˜“çš„å¸ç§å¯¹ | `BTCUSDT` / `ETHUSDT` |
| æ–¹å‘ | å¤šå¤´æˆ–ç©ºå¤´ | `å¤šå¤´` / `ç©ºå¤´` |
| ä»·æ ¼ | äº¤æ˜“æ‰§è¡Œä»·æ ¼ | `67,500.00` |
| æ•°é‡ | äº¤æ˜“æ•°é‡ | `0.0100` |
| ç›ˆäº | å¹³ä»“æ—¶çš„ç›ˆäºé‡‘é¢ | `+7.00 USDT` / `-3.50 USDT` |
| å¤‡æ³¨ | äº¤æ˜“è§¦å‘åŸå›  | `EMAäº¤å‰ä¿¡å·` |

## ğŸ“ˆ è®°å½•ç¤ºä¾‹

### å¼€ä»“è®°å½•
```
[2025-10-12 20:29:30] å¼€ä»“ | BTCUSDT | å¤šå¤´ | 67,500.00 | 0.0100 | - | EMAäº¤å‰ä¿¡å·
```

### å¹³ä»“è®°å½•
```
[2025-10-12 20:29:30] å¹³ä»“ | BTCUSDT | å¤šå¤´ | 68,200.00 | 0.0100 | +7.00 USDT | EMAäº¤å‰ä¿¡å·
```

## ğŸ”„ è‡ªåŠ¨è®°å½•æœºåˆ¶

ç³»ç»Ÿä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨å†™å…¥äº¤æ˜“è®°å½•ï¼š

1. **å¼€ä»“æ—¶**ï¼šè®°å½•å¼€ä»“ä»·æ ¼ã€æ•°é‡ã€æ–¹å‘
2. **å¹³ä»“æ—¶**ï¼šè®°å½•å¹³ä»“ä»·æ ¼ã€æ•°é‡ã€ç›ˆäºé‡‘é¢

## ğŸ’° ç›ˆäºè®¡ç®—

- **å¤šå¤´ç›ˆäº** = (å¹³ä»“ä»·æ ¼ - å¼€ä»“ä»·æ ¼) Ã— æ•°é‡ Ã— æ æ†å€æ•°
- **ç©ºå¤´ç›ˆäº** = (å¼€ä»“ä»·æ ¼ - å¹³ä»“ä»·æ ¼) Ã— æ•°é‡ Ã— æ æ†å€æ•°

## ğŸ“Š æ•°æ®åˆ†æå»ºè®®

æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶è¿›è¡Œï¼š

1. **äº¤æ˜“ç»Ÿè®¡**ï¼šè®¡ç®—æ€»äº¤æ˜“æ¬¡æ•°ã€èƒœç‡ã€å¹³å‡ç›ˆäº
2. **ç­–ç•¥åˆ†æ**ï¼šåˆ†æä¸åŒæ—¶é—´æ®µçš„äº¤æ˜“è¡¨ç°
3. **é£é™©ç®¡ç†**ï¼šç›‘æ§æœ€å¤§å›æ’¤å’Œè¿ç»­äºæŸ
4. **Excelåˆ†æ**ï¼šå°†æ•°æ®å¯¼å…¥Excelè¿›è¡Œå›¾è¡¨åˆ†æ

## ğŸ› ï¸ æ–‡ä»¶ç®¡ç†

- æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- è®°å½•ä¼šæŒç»­è¿½åŠ ï¼Œä¸ä¼šè¦†ç›–å†å²æ•°æ®
- å»ºè®®å®šæœŸå¤‡ä»½é‡è¦çš„äº¤æ˜“è®°å½•
- å¯ä»¥æ‰‹åŠ¨æ¸…ç©ºæ–‡ä»¶é‡æ–°å¼€å§‹è®°å½•

## âš ï¸ æ³¨æ„äº‹é¡¹

1. æ–‡ä»¶ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒä¸­æ–‡æ˜¾ç¤º
2. æ—¶é—´æ ¼å¼ä¸º24å°æ—¶åˆ¶
3. ä»·æ ¼æ˜¾ç¤ºåŒ…å«åƒä½åˆ†éš”ç¬¦
4. ç›ˆäºé‡‘é¢æ˜¾ç¤ºæ­£è´Ÿå·å’Œè´§å¸å•ä½
5. æ¨¡æ‹Ÿäº¤æ˜“å’ŒçœŸå®äº¤æ˜“éƒ½ä¼šè¢«è®°å½•

## ğŸ¯ åŠ¨æ€æ æ†åŠŸèƒ½è¯¦è§£

### ğŸ“Š æ æ†è°ƒæ•´è§„åˆ™

ç³»ç»Ÿé‡‡ç”¨æ™ºèƒ½æ æ†è°ƒæ•´ç­–ç•¥ï¼Œæ ¹æ®äº¤æ˜“ç»“æœè‡ªåŠ¨ä¼˜åŒ–é£é™©ç®¡ç†ï¼š

| äº¤æ˜“ç»“æœ | æ æ†è°ƒæ•´è§„åˆ™ | ç¤ºä¾‹ |
|----------|-------------|------|
| ç›ˆåˆ©äº¤æ˜“ | æ æ†é‡ç½®ä¸ºåŸºç¡€å€¼25x | 30x â†’ 25x |
| äºæŸäº¤æ˜“ | æ æ†å¢åŠ 2å€ | 25x â†’ 27x |

### ğŸ”„ è°ƒæ•´æœºåˆ¶

1. **åˆå§‹çŠ¶æ€**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶æ æ†ä¸º25xï¼ˆåŸºç¡€æ æ†ï¼‰
2. **äºæŸå¤„ç†**ï¼šæ¯æ¬¡äºæŸåï¼Œä¸‹ä¸€å•æ æ†å¢åŠ 2å€
3. **ç›ˆåˆ©é‡ç½®**ï¼šä¸€æ—¦ç›ˆåˆ©ï¼Œæ æ†ç«‹å³å›å½’25xåŸºç¡€å€¼
4. **è¿ç»­è°ƒæ•´**ï¼šæ”¯æŒè¿ç»­äºæŸæ—¶æ æ†æŒç»­å¢åŠ 

### ğŸ“ˆ è°ƒæ•´ç¤ºä¾‹

```
äº¤æ˜“åºåˆ—ï¼šäºæŸ â†’ äºæŸ â†’ ç›ˆåˆ© â†’ äºæŸ
æ æ†å˜åŒ–ï¼š25x â†’ 27x â†’ 29x â†’ 25x â†’ 27x
```

### ğŸ›¡ï¸ é£é™©æ§åˆ¶

- **åŸºç¡€æ æ†**ï¼š25å€ï¼Œå¹³è¡¡æ”¶ç›Šä¸é£é™©
- **å¢é‡æ§åˆ¶**ï¼šæ¯æ¬¡ä»…å¢åŠ 2å€ï¼Œé¿å…è¿‡åº¦é£é™©
- **åŠæ—¶é‡ç½®**ï¼šç›ˆåˆ©åç«‹å³é‡ç½®ï¼Œé˜²æ­¢æ æ†è¿‡é«˜

### ğŸ“ æ—¥å¿—è®°å½•

ç³»ç»Ÿä¼šè¯¦ç»†è®°å½•æ‰€æœ‰æ æ†è°ƒæ•´ï¼š

```
2025-10-18 22:01:47 - INFO - ğŸ“‰ ETHUSDT æœ¬æ¬¡äº¤æ˜“äºæŸ -3.00 USDTï¼Œæ æ†å¢åŠ åˆ° 27x
2025-10-18 22:01:47 - INFO - ğŸ”„ ETHUSDT æ æ†è°ƒæ•´: 25x â†’ 27x
2025-10-18 22:01:47 - INFO - âœ… ETHUSDT å¸å®‰æ æ†å·²æ›´æ–°ä¸º 27x
```

## ğŸ”§ è‡ªå®šä¹‰è®¾ç½®

å¦‚éœ€ä¿®æ”¹è®°å½•æ ¼å¼æˆ–æ·»åŠ æ›´å¤šå­—æ®µï¼Œå¯ä»¥ç¼–è¾‘ `web_trader.py` æ–‡ä»¶ä¸­çš„ `write_trade_record` æ–¹æ³•ã€‚

### åŠ¨æ€æ æ†å‚æ•°è°ƒæ•´

å¯åœ¨ `CONFIG` é…ç½®ä¸­ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š

```python
CONFIG = {
    "base_leverage": 25,        # åŸºç¡€æ æ†å€æ•°
    "leverage_increment": 2,    # äºæŸåæ æ†å¢åŠ é‡
}
```

## ğŸš€ æœåŠ¡å™¨è‡ªåŠ¨å¯åŠ¨é…ç½®

ç³»ç»Ÿå·²é…ç½®ä¸ºsystemdæœåŠ¡ï¼Œæ”¯æŒæœåŠ¡å™¨é‡å¯åè‡ªåŠ¨å¯åŠ¨ã€‚

### ğŸ“‹ æœåŠ¡é…ç½®

- **æœåŠ¡åç§°**ï¼š`web-trader.service`
- **æœåŠ¡æè¿°**ï¼šWeb Trader - Dynamic Leverage Trading System
- **è‡ªåŠ¨å¯åŠ¨**ï¼šå·²å¯ç”¨å¼€æœºè‡ªå¯
- **é‡å¯ç­–ç•¥**ï¼šæœåŠ¡å¼‚å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼ˆé—´éš”10ç§’ï¼‰

### ğŸ› ï¸ æœåŠ¡ç®¡ç†å‘½ä»¤

#### ä½¿ç”¨systemctlå‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status web-trader.service

# å¯åŠ¨æœåŠ¡
sudo systemctl start web-trader.service

# åœæ­¢æœåŠ¡
sudo systemctl stop web-trader.service

# é‡å¯æœåŠ¡
sudo systemctl restart web-trader.service

# å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable web-trader.service

# ç¦ç”¨å¼€æœºè‡ªå¯
sudo systemctl disable web-trader.service

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u web-trader.service -f
```

### ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

- **æ ‡å‡†è¾“å‡ºæ—¥å¿—**ï¼š`/home/ubuntu/Code/quant/simple_live_trading/logs/web_trader_service.log`
- **é”™è¯¯æ—¥å¿—**ï¼š`/home/ubuntu/Code/quant/simple_live_trading/logs/web_trader_service_error.log`
- **ç³»ç»Ÿæ—¥å¿—**ï¼šé€šè¿‡ `journalctl -u web-trader.service` æŸ¥çœ‹

### ğŸ”§ æœåŠ¡é…ç½®æ–‡ä»¶

æœåŠ¡é…ç½®æ–‡ä»¶ä½äºï¼š`/etc/systemd/system/web-trader.service`

ä¸»è¦é…ç½®ï¼š
```ini
[Unit]
Description=Web Trader Service
After=network.target

[Service]
User=ubuntu
WorkingDirectory=/home/ubuntu/Code/quant/simple_live_trading
ExecStart=/home/ubuntu/miniconda3/bin/conda run -n quant python web_trader.py
Restart=always
RestartSec=3
StandardOutput=append:/home/ubuntu/Code/quant/simple_live_trading/logs/web_trader_service.log
StandardError=append:/home/ubuntu/Code/quant/simple_live_trading/logs/web_trader_service_error.log

[Install]
WantedBy=multi-user.target
```

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒä¾èµ–**ï¼šæœåŠ¡ä¾èµ–condaç¯å¢ƒ`quant`ï¼Œç¡®ä¿ç¯å¢ƒæ­£å¸¸
2. **ç«¯å£å ç”¨**ï¼šæœåŠ¡ä½¿ç”¨5001ç«¯å£ï¼Œç¡®ä¿ç«¯å£æœªè¢«å ç”¨
3. **æƒé™è¦æ±‚**ï¼šæœåŠ¡ç®¡ç†éœ€è¦sudoæƒé™
4. **æ—¥å¿—ç›‘æ§**ï¼šå»ºè®®å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶ï¼Œç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€
5. **é…ç½®æ›´æ–°**ï¼šä¿®æ”¹é…ç½®åéœ€è¦é‡æ–°åŠ è½½æœåŠ¡ï¼š
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart web-trader.service
   ```

### ğŸ¯ å¼€æœºè‡ªå¯éªŒè¯

é‡å¯æœåŠ¡å™¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯è‡ªåŠ¨å¯åŠ¨ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status web-trader.service

# æ£€æŸ¥ç«¯å£ç›‘å¬
lsof -i:5001

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep web_trader.py
```

æœåŠ¡æ­£å¸¸å¯åŠ¨åï¼Œå¯é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š`http://æœåŠ¡å™¨IP:5001`

## ğŸ”§ å…¶ä»–å¯åŠ¨æ–¹å¼

### ğŸ“± nohupåå°å¯åŠ¨

å¦‚æœä¸æƒ³ä½¿ç”¨systemdæœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨nohupå‘½ä»¤åå°å¯åŠ¨ï¼š

#### åŸºæœ¬nohupå¯åŠ¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ubuntu/Code/quant/simple_live_trading

# æ¿€æ´»condaç¯å¢ƒå¹¶åå°å¯åŠ¨
conda activate quant
nohup python web_trader.py > web_trader_nohup.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep web_trader.py

# æŸ¥çœ‹æ—¥å¿—
tail -f web_trader_nohup.log
```

#### ä½¿ç”¨å¯åŠ¨è„šæœ¬çš„nohupæ–¹å¼

```bash
# æˆ–è€…ç›´æ¥æŒ‡å®šcondaç¯å¢ƒ
nohup /home/ubuntu/miniconda3/envs/quant/bin/python web_trader.py > web_trader_nohup.log 2>&1 &
```

#### nohupè¿›ç¨‹ç®¡ç†

```bash
# æŸ¥æ‰¾è¿›ç¨‹ID
ps aux | grep web_trader.py | grep -v grep

# åœæ­¢è¿›ç¨‹ï¼ˆæ›¿æ¢PIDä¸ºå®é™…è¿›ç¨‹IDï¼‰
kill -9 <PID>

# æˆ–è€…ä½¿ç”¨pkill
pkill -f web_trader.py

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:5001
```

### âš™ï¸ ä¿®æ”¹è‡ªåŠ¨å¯åŠ¨é…ç½®

#### ä¿®æ”¹systemdæœåŠ¡é…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹æœåŠ¡çš„å¯åŠ¨å‚æ•°ã€ç¯å¢ƒå˜é‡æˆ–å…¶ä»–é…ç½®ï¼š

```bash
# 1. ç¼–è¾‘æœåŠ¡é…ç½®æ–‡ä»¶
sudo nano /etc/systemd/system/web-trader.service

# 2. é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# 3. é‡å¯æœåŠ¡
sudo systemctl restart web-trader.service
```

#### å¸¸è§é…ç½®ä¿®æ”¹ç¤ºä¾‹

**ä¿®æ”¹å·¥ä½œç›®å½•ï¼š**
```ini
[Service]
WorkingDirectory=/æ–°çš„/å·¥ä½œ/ç›®å½•
```

**ä¿®æ”¹Pythonç¯å¢ƒï¼š**
```ini
[Service]
ExecStart=/path/to/your/python /path/to/web_trader.py
```

**æ·»åŠ ç¯å¢ƒå˜é‡ï¼š**
```ini
[Service]
Environment="API_KEY=your_api_key"
Environment="SECRET_KEY=your_secret_key"
```

**ä¿®æ”¹é‡å¯ç­–ç•¥ï¼š**
```ini
[Service]
Restart=on-failure          # ä»…å¤±è´¥æ—¶é‡å¯
# æˆ–
Restart=no                   # ä¸è‡ªåŠ¨é‡å¯
```

**ä¿®æ”¹ç”¨æˆ·å’Œç»„ï¼š**
```ini
[Service]
User=your_username
Group=your_group
```

#### ç¦ç”¨è‡ªåŠ¨å¯åŠ¨

å¦‚æœä¸éœ€è¦å¼€æœºè‡ªå¯ï¼š

```bash
# ç¦ç”¨å¼€æœºè‡ªå¯
sudo systemctl disable web-trader.service

# åœæ­¢æœåŠ¡
sudo systemctl stop web-trader.service

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status web-trader.service
```

#### å®Œå…¨ç§»é™¤systemdæœåŠ¡

```bash
# 1. åœæ­¢å¹¶ç¦ç”¨æœåŠ¡
sudo systemctl stop web-trader.service

# 2. åˆ é™¤æœåŠ¡æ–‡ä»¶
sudo rm /etc/systemd/system/web-trader.service

# 3. é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload

# 4. é‡ç½®å¤±è´¥çŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰
sudo systemctl reset-failed
```

### ğŸ”„ å¯åŠ¨æ–¹å¼å¯¹æ¯”

| å¯åŠ¨æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| **systemdæœåŠ¡** | å¼€æœºè‡ªå¯ã€è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†ã€ç³»ç»Ÿé›†æˆ | éœ€è¦rootæƒé™é…ç½® | ç”Ÿäº§ç¯å¢ƒã€é•¿æœŸè¿è¡Œ |
| **nohupåå°** | ç®€å•å¿«é€Ÿã€æ— éœ€rootæƒé™ | ä¸ä¼šå¼€æœºè‡ªå¯ã€éœ€æ‰‹åŠ¨ç®¡ç† | ä¸´æ—¶æµ‹è¯•ã€å¼€å‘ç¯å¢ƒ |
| **ç›´æ¥è¿è¡Œ** | æœ€ç®€å•ã€ä¾¿äºè°ƒè¯• | ç»ˆç«¯å…³é—­å³åœæ­¢ | å¼€å‘è°ƒè¯• |

### ğŸ“ é…ç½®æ–‡ä»¶å¤‡ä»½

å»ºè®®å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ï¼š

```bash
# å¤‡ä»½systemdæœåŠ¡æ–‡ä»¶
sudo cp /etc/systemd/system/web-trader.service /home/ubuntu/Code/quant/simple_live_trading/web-trader.service.backup

# å¤‡ä»½å¯åŠ¨è„šæœ¬
cp /home/ubuntu/Code/quant/simple_live_trading/start_web_trader.sh /home/ubuntu/Code/quant/simple_live_trading/start_web_trader.sh.backup

# å¤‡ä»½ç®¡ç†è„šæœ¬
cp /home/ubuntu/Code/quant/simple_live_trading/manage_service.sh /home/ubuntu/Code/quant/simple_live_trading/manage_service.sh.backup
```