# MyQuant 量化交易系统 - 操作说明

## 📋 目录
- [系统概述](#系统概述)
- [环境配置](#环境配置)
- [快速开始](#快速开始)
- [策略运行](#策略运行)
- [配置管理](#配置管理)
- [结果分析](#结果分析)
- [常见问题](#常见问题)

## 🎯 系统概述

MyQuant是一个基于Python的量化交易回测系统，专注于EMA交叉策略的研究和优化。系统提供了多种策略实现和完整的回测分析功能。

### 核心功能
- ✅ 多种EMA交叉策略实现
- ✅ 统一的策略运行框架
- ✅ 实时数据获取和缓存
- ✅ 详细的回测分析和可视化
- ✅ 策略对比和性能评估
- ✅ 分批入场和风险控制
- ✅ 完整的交易记录和日志

### 系统架构
```
MyQuant系统
├── 数据管理层 (DataManager)
├── 策略执行层 (BaseStrategy + 具体策略)
├── 配置管理层 (ConfigManager)
├── 运行控制层 (StrategyRunner)
└── 分析展示层 (图表生成 + 报告输出)
```

### 可用策略
1. **简单EMA交叉策略** (`simple_ema`) - 基础的双EMA交叉策略
2. **分批入场EMA交叉策略** (`staged_ema`) - 支持分批入场的EMA策略
3. **复杂EMA交叉策略** (`complex_ema`) - 多重确认的EMA策略
4. **高级分批入场EMA交叉策略** (`advanced_staged_ema`) - 高级分批入场策略

## ⚙️ 环境配置

### 1. Python环境要求
- Python 3.7+
- 推荐使用虚拟环境

### 2. 创建虚拟环境
```powershell
# 创建名为myquant的虚拟环境
python -m venv myquant

# 激活虚拟环境 (Windows PowerShell)
.\myquant\Scripts\Activate.ps1

# 激活虚拟环境 (Windows CMD)
myquant\Scripts\activate.bat
```

### 3. 安装依赖
```powershell
# 安装所需的Python库
pip install -r requirements.txt
```

### 4. 必需的Python库
```
pandas>=1.3.0
numpy>=1.21.0
matplotlib>=3.4.0
requests>=2.25.0
python-binance>=1.0.15
python-dotenv>=0.19.0
tabulate>=0.8.9
```

### 5. 环境变量配置
创建 `.env` 文件（可选，用于API密钥）：
```
BINANCE_API_KEY=your_api_key_here
BINANCE_SECRET_KEY=your_secret_key_here
```

## 🚀 快速开始

### 1. 运行单个策略
```powershell
# 运行分批入场EMA交叉策略
python run_strategy.py staged_ema

# 运行简单EMA交叉策略
python run_strategy.py simple_ema

# 运行复杂EMA交叉策略
python run_strategy.py complex_ema

# 运行高级分批入场EMA交叉策略
python run_strategy.py advanced_staged_ema
```

### 2. 运行所有策略对比
```powershell
# 运行所有策略并生成对比报告
python run_strategy.py all
```

### 3. 查看帮助信息
```powershell
python run_strategy.py --help
```

## 📊 策略运行

### 1. 策略参数说明

#### 通用参数
- `symbol`: 交易对（默认：BTCUSDT）
- `start_date`: 开始日期（默认：1 Oct, 2024）
- `end_date`: 结束日期（默认：8 Oct, 2024）
- `initial_capital`: 初始资金（默认：10000 USDT）
- `leverage`: 杠杆倍数（默认：1.0）
- `fee`: 手续费率（默认：0.0004）

#### EMA参数
- `ema_short`: 短期EMA周期（默认：9）
- `ema_long`: 长期EMA周期（默认：26）

#### 分批入场参数（staged_ema）
- `long_entry_stages`: 多头分批入场比例
- `short_entry_stages`: 空头分批入场比例
- `add_position_threshold`: 加仓阈值

### 2. 策略运行流程

1. **数据获取**: 从Binance API获取历史K线数据
2. **数据处理**: 计算技术指标（EMA等）
3. **信号生成**: 根据策略逻辑生成交易信号
4. **仓位管理**: 执行开仓、加仓、平仓操作
5. **风险控制**: 应用止损、止盈等风控措施
6. **结果统计**: 计算收益率、胜率等性能指标
7. **图表生成**: 生成交易图表和分析报告

### 3. 输出文件说明

运行完成后，系统会在 `output/` 目录下生成：

#### 图表文件 (`output/charts/`)
- `{策略名}_30min_交易图表.png`: 30分钟K线交易图表
- `{策略名}_交易分析.png`: 策略分析图表
- `cumulative_returns_comparison.png`: 累计收益对比图（运行all时）

#### 交易记录 (`output/`)
- `trades_detailed_log_{策略名}.json`: 详细交易记录
- `strategy_comparison_report.txt`: 策略对比报告（运行all时）

#### 数据缓存 (`output/monthly_data/`)
- `{交易对}_{年月}_1m.pkl`: 月度K线数据缓存

## ⚙️ 配置管理

### 1. 配置文件说明

配置文件位置：`config.json`

主要配置项：
- `global`: 全局交易配置
- `strategies`: 策略配置
  - `simple_ema`: 简单EMA策略配置
  - `staged_ema`: 分批入场EMA策略配置
  - `complex_ema`: 复杂EMA策略配置
  - `advanced_staged_ema`: 高级分批入场策略配置
- `logging`: 日志配置
- `chart`: 图表配置
- `backtest`: 回测配置
- `output`: 输出配置

### 2. 配置文件结构

### 3. 修改策略参数
```json
{
  "staged_ema": {
    "symbol": "BTCUSDT",
    "start_date": "1 Oct, 2024",
    "end_date": "8 Oct, 2024",
    "initial_capital": 10000.0,
    "leverage": 1.0,
    "fee": 0.0004,
    "ema_short": 9,
    "ema_long": 26,
    "long_entry_stages": [0.3, 0.3, 0.4],
    "short_entry_stages": [0.3, 0.3, 0.4],
    "add_position_threshold": 0.02
  }
}
```

### 4. 配置示例

完整的配置文件示例请参考项目根目录下的 `config.json` 文件。

## 📈 结果分析

### 1. 性能指标说明

- **总交易次数**: 策略执行的总交易数量
- **胜率**: 盈利交易占总交易的比例
- **总收益率**: (最终资金 - 初始资金) / 初始资金
- **平均收益率**: 每笔交易的平均收益率
- **最大单笔盈利**: 单笔交易的最大盈利比例
- **最大单笔亏损**: 单笔交易的最大亏损比例
- **最终资金**: 回测结束时的总资金

### 2. 图表解读

#### 交易图表
- **蓝线**: 价格K线图
- **橙线**: 短期EMA
- **绿线**: 长期EMA
- **红色箭头**: 买入信号
- **蓝色箭头**: 卖出信号

#### 分析图表
- **资金曲线**: 显示资金随时间的变化
- **收益分布**: 显示交易收益的分布情况

### 3. 交易记录分析

详细交易记录包含：
- 交易时间和价格
- 仓位大小和资金使用
- 交易类型（开仓/加仓/平仓）
- 盈亏计算和手续费
- 交易原因和状态

## ❓ 常见问题

### 1. 数据获取问题

**Q: 无法获取数据或数据获取缓慢？**
A: 
- 检查网络连接
- 确认Binance API可访问
- 使用缓存数据（系统会自动缓存）

### 2. 策略运行问题

**Q: 策略无交易信号？**
A:
- 检查策略参数设置
- 确认数据时间范围
- 调整EMA周期参数
- 查看市场条件是否符合策略逻辑

**Q: 收益率计算异常？**
A:
- 确认初始资金设置正确
- 检查手续费率设置
- 验证杠杆倍数配置

### 3. 环境配置问题

**Q: 导入模块失败？**
A:
- 确认虚拟环境已激活
- 重新安装依赖包：`pip install -r requirements.txt`
- 检查Python版本（需要3.7+）

**Q: 图表显示异常？**
A:
- 确认matplotlib正确安装
- 检查中文字体配置
- 更新图形库版本

### 4. 性能优化

**Q: 回测速度慢？**
A:
- 减少数据时间范围
- 使用缓存数据
- 调整策略复杂度

**Q: 内存使用过高？**
A:
- 分段处理大量数据
- 清理不必要的数据缓存
- 优化策略算法

## 📞 技术支持

如遇到其他问题，请：
1. 查看系统日志输出
2. 检查配置文件格式
3. 确认数据完整性
4. 参考算法说明文档

---

**版本**: v2.0  
**更新日期**: 2024年12月  
**维护状态**: 活跃维护